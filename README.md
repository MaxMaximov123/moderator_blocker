# Moderator Blocker Bot

Telegram-бот для автоматизации управления группами, лимитирования сообщений пользователей, рассылок и приветствий. Поддерживает асинхронную работу, интеграцию с PostgreSQL и гибкую настройку через панель администратора.

## Возможности

- **Лимит сообщений**: Автоматическое ограничение количества сообщений для новых пользователей в группах.
- **Приветствие**: Отправка кастомных приветственных сообщений новым участникам.
- **Рассылки**: Планирование постов по времени или с заданным интервалом, поддержка медиа.
- **Удаление и закрепление сообщений**: Гибкие опции удаления и закрепления рассылок.
- **Панель администратора**: Управление группами, лимитами, шаблонами сообщений через Telegram.
- **Интеграция с PostgreSQL**: Хранение данных о группах, пользователях и рассылках.
- **Docker**: Легкий запуск и деплой через Docker и docker-compose.

## Быстрый старт

### 1. Клонируйте репозиторий

```sh
git clone <repo-url>
cd moderator_blocker
```

### 2. Настройте переменные окружения

Создайте файл `.env` (пример уже есть):

```
PYTHONUNBUFFERED=1
DATABASE_URL=postgresql+asyncpg://postgres:postgres@<host>:<port>/moderator_bot
BOT_TOKEN=<ваш_telegram_bot_token>
ADMIN_IDS=123456789 987654321 # через пробел, если несколько
```

### 3. Запуск через Docker

```sh
docker-compose up --build
```

Бот и база данных будут запущены в контейнерах.

### 4. Локальный запуск (без Docker)

- Установите Python 3.11+ и PostgreSQL.
- Установите зависимости:

```sh
pip install -r requirements.txt
```

- Запустите бота:

```sh
python -m bot.main
```

## Структура проекта

- `bot/` — исходный код бота
  - `main.py` — точка входа
  - `handlers/` — обработчики событий и команд
  - `scheduler.py` — планировщик рассылок
  - `states.py` — состояния FSM для aiogram
  - `keyboards/` — клавиатуры для Telegram
- `db/` — работа с базой данных
  - `models.py` — SQLAlchemy-модели
  - `session.py` — создание сессий
- `migrations/` — миграции alembic (если используются)
- `Dockerfile`, `docker-compose.yml` — контейнеризация
- `.env` — переменные окружения

## Основные команды

- `/start` — запуск панели администратора
- "Мои группы" — просмотр и управление группами
- Настройка лимитов, приветствий, рассылок — через inline-кнопки

## Как добавить нового администратора

1. Добавьте его Telegram ID в переменную `ADMIN_IDS` в `.env` через пробел или вручную в таблицу admins в базе данных.
2. Перезапустите бота.

## Миграции базы данных

Для управления схемой используйте Alembic:

```sh
alembic revision --autogenerate -m "описание"
alembic upgrade head
```

## Зависимости

- [aiogram](https://docs.aiogram.dev/) — Telegram Bot API
- [SQLAlchemy](https://docs.sqlalchemy.org/) — ORM
- [asyncpg](https://github.com/MagicStack/asyncpg) — асинхронный драйвер PostgreSQL
- [APScheduler](https://apscheduler.readthedocs.io/) — планировщик задач
- [python-dotenv](https://github.com/theskumar/python-dotenv) — переменные окружения

## Лицензия

MIT

---

**Внимание:** Никогда не публикуйте свой `BOT_TOKEN` и другие секреты в публичных репозиториях!
```
